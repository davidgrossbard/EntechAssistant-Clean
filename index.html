<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EntechAssistant Report System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        #root { min-height: 100vh; }
        select { -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.7rem center; background-size: 1.2em; padding-right: 2.5rem; }
        
        /* Professional, clean styling optimized for PDF */
        .fade-in { opacity: 1; }
        .slide-up { opacity: 1; }
        
        .gradient-text { 
            background: linear-gradient(135deg, #dc2626, #991b1b); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
        }
        
        .card-hover { 
            transition: all 0.2s ease;
        }
        .card-hover:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .glass-effect { 
            background: rgba(31, 41, 55, 0.95); 
            border: 1px solid rgba(75, 85, 99, 0.3); 
            border-radius: 12px;
        }
        
        .toast { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            z-index: 9999; 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-weight: 500; 
            animation: slideInRight 0.3s ease-out; 
        }
        @keyframes slideInRight { 
            from { opacity: 0; transform: translateX(100%); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        
        /* Optimized print/PDF styles */
        @media print { 
            * { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; }
            .no-print { display: none !important; }
            .print-page { 
                page-break-after: always; 
                min-height: 100vh; 
                width: 100% !important;
                margin: 0 !important;
                padding: 20px !important;
                background: white !important;
            }
            .print-page:last-child { page-break-after: auto; }
            body { background: white !important; }
        }
        
        /* Professional report styling */
        .report-page {
            background: white;
            min-height: 100vh;
            padding: 40px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.5;
        }
        
        .page-header {
            border-bottom: 3px solid #dc2626;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }
        
        .metric-box {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .problem-box {
            background: #fef2f2;
            border: 2px solid #fca5a5;
            border-left: 6px solid #dc2626;
            border-radius: 8px;
            padding: 24px;
            margin: 20px 0;
        }
        
        .solution-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-left: 6px solid #16a34a;
            border-radius: 8px;
            padding: 24px;
            margin: 20px 0;
        }
        
        .highlight-number {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(to right, #dc2626, #fca5a5, #dc2626);
            margin: 40px 0;
            border-radius: 2px;
        }
        
        /* Better mobile responsive */
        @media (max-width: 768px) {
            .mobile-stack { flex-direction: column; }
            .mobile-full { width: 100%; }
            .report-page { padding: 20px; }
            .highlight-number { font-size: 2rem; }
        }
    </style>
    <!-- Load the data file -->
    <script src="data.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Check if data is loaded
        if (!window.entechData || window.entechData.length === 0) {
            document.getElementById('root').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #1a1a1a; color: white; text-align: center; padding: 20px;">
                    <div>
                        <h1 style="font-size: 2rem; margin-bottom: 1rem;">‚ö†Ô∏è Data Not Found</h1>
                        <p style="margin-bottom: 1rem;">Please make sure data.js is in the same folder as this HTML file.</p>
                        <p style="color: #888;">If you need to populate the data file, check the instructions in data.js</p>
                    </div>
                </div>
            `;
        } else {
            // Data is loaded, run the app
            const embeddedData = window.entechData;
            
            // Icon components
            const ChevronLeft = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
            );
            
            const ChevronRight = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
            );
            
            const Home = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            );
            
            const Building = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
            );
            
            const Search = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            );
            
            const Users = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            );
            
            const DollarSign = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            );
            
            const Download = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            );
            
            const Mail = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
            );
            
            const Copy = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            );
            
            const External = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
            );
            
            const Check = ({className = "w-6 h-6"}) => (
                <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
            );
            
            // Utility functions
            const parseCurrency = (value) => {
                if (!value || value === '$0.00') return 'n/a';
                return value;
            };
            
            const parseNumber = (value) => {
                if (typeof value === 'string') {
                    return parseFloat(value.replace(/[$,]/g, '')) || 0;
                }
                return value || 0;
            };
            
            const formatCurrency = (value) => {
                if (!value || value === '$0.00' || value === 0) return 'n/a';
                if (typeof value === 'number') {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0,
                    }).format(value);
                }
                return value;
            };
            
            const groupBy = (array, key) => {
                return array.reduce((result, item) => {
                    const group = item[key];
                    if (!result[group]) result[group] = [];
                    result[group].push(item);
                    return result;
                }, {});
            };
            
            // URL utility functions
            const getManagementFromURL = () => {
                const params = new URLSearchParams(window.location.search);
                const management = params.get('management');
                return management ? decodeURIComponent(management) : null;
            };
            
            const setManagementInURL = (managementName) => {
                const url = new URL(window.location);
                if (managementName) {
                    url.searchParams.set('management', encodeURIComponent(managementName));
                } else {
                    url.searchParams.delete('management');
                }
                window.history.pushState({}, '', url);
            };
            
            const generateManagementLink = (managementName) => {
                const url = new URL(window.location.href);
                url.searchParams.set('management', encodeURIComponent(managementName));
                return url.toString();
            };
            
            // Enhanced utility functions for new features
            const showToast = (message, type = 'success') => {
                const toast = document.createElement('div');
                toast.className = `toast ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'} text-white`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => document.body.removeChild(toast), 3000);
            };
            
            const generateBulkClientData = (managements) => {
                return managements.map(management => ({
                    name: management.name,
                    buildingCount: management.buildingCount,
                    totalSavings: formatCurrency(management.totalSavings),
                    totalDowntime: management.totalDowntime,
                    downtime_cost: formatCurrency(management.totalDowntimeCost),
                    link: generateManagementLink(management.name),
                    contact: `${management.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()}@email.com` // Placeholder email
                }));
            };
            
            const downloadCSV = (data, filename) => {
                const headers = ['Company Name', 'Buildings', 'Current Savings', 'Downtime Days', 'Lost Savings', 'Report Link', 'Contact Email'];
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => [
                        `"${row.name}"`,
                        row.buildingCount,
                        `"${row.totalSavings}"`,
                        row.totalDowntime,
                        `"${row.downtime_cost}"`,
                        `"${row.link}"`,
                        `"${row.contact}"`
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);
            };
            
            const generateEmailTemplate = (managements) => {
                const emailData = managements.map(m => ({
                    to: `${m.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()}@email.com`,
                    subject: `Your Energy Savings Report - ${m.name}`,
                    body: `Dear ${m.name} team,

We're pleased to share your personalized energy management report for your ${m.buildingCount} building${m.buildingCount > 1 ? 's' : ''}.

Key Highlights:
‚Ä¢ Current Annual Savings: ${formatCurrency(m.totalSavings)}
‚Ä¢ System Downtime: ${m.totalDowntime} days
‚Ä¢ Potential Additional Savings: ${formatCurrency(m.totalDowntimeCost)}

View your full interactive report: ${generateManagementLink(m.name)}

Best regards,
The Entech Team`
                })).map(email => `TO: ${email.to}\nSUBJECT: ${email.subject}\n\n${email.body}`).join('\n\n---\n\n');
                
                const blob = new Blob([emailData], { type: 'text/plain' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'client_emails.txt';
                link.click();
                URL.revokeObjectURL(link.href);
            };
            
            // PDF Export functionality
            const exportToPDF = async (managementName, reportData, currentPage, totalPages) => {
                showToast('Preparing PDF export...', 'info');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const pageElement = document.querySelector('.pt-16 > div');
                if (!pageElement) {
                    showToast('Error: Report content not found', 'error');
                    return;
                }
                
                try {
                    // Hide navigation elements
                    const navElements = document.querySelectorAll('.no-print, .fixed');
                    navElements.forEach(el => el.style.display = 'none');
                    
                    const canvas = await html2canvas(pageElement, {
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff',
                        width: pageElement.scrollWidth,
                        height: pageElement.scrollHeight,
                        logging: false,
                        letterRendering: true,
                        foreignObjectRendering: true
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 297; // A4 width in mm (landscape)
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, Math.min(imgHeight, 210));
                    
                    // Restore navigation elements
                    navElements.forEach(el => el.style.display = '');
                    
                    pdf.save(`${managementName.replace(/[^a-zA-Z0-9]/g, '_')}_Report.pdf`);
                    showToast('PDF exported successfully!', 'success');
                } catch (error) {
                    console.error('PDF export error:', error);
                    showToast('Error exporting PDF', 'error');
                    
                    // Restore navigation elements on error
                    const navElements = document.querySelectorAll('.no-print, .fixed');
                    navElements.forEach(el => el.style.display = '');
                }
            };
            
            const exportFullReportToPDF = async (managementName, reportData, setCurrentPage, totalPages) => {
                showToast('Exporting full report to PDF...', 'info');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                try {
                    for (let i = 0; i < totalPages; i++) {
                        setCurrentPage(i);
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait for page to render
                        
                        const pageElement = document.querySelector('.pt-16 > div');
                        if (pageElement) {
                            const navElements = document.querySelectorAll('.no-print, .fixed');
                            navElements.forEach(el => el.style.display = 'none');
                            
                            const canvas = await html2canvas(pageElement, {
                                scale: 1.5,
                                useCORS: true,
                                allowTaint: true,
                                backgroundColor: '#ffffff',
                                logging: false,
                                letterRendering: true,
                                foreignObjectRendering: true
                            });
                            
                            const imgData = canvas.toDataURL('image/png');
                            const imgWidth = 297;
                            const imgHeight = (canvas.height * imgWidth) / canvas.width;
                            
                            if (i > 0) pdf.addPage();
                            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, Math.min(imgHeight, 210));
                            
                            navElements.forEach(el => el.style.display = '');
                        }
                    }
                    
                    pdf.save(`${managementName.replace(/[^a-zA-Z0-9]/g, '_')}_Full_Report.pdf`);
                    showToast('Full PDF report exported successfully!', 'success');
                } catch (error) {
                    console.error('Full PDF export error:', error);
                    showToast('Error exporting full PDF', 'error');
                }
            };
            
            // Debug function to test URL matching
            const testManagementMatch = (managementName) => {
                const encoded = encodeURIComponent(managementName);
                const decoded = decodeURIComponent(encoded);
                console.log('Original:', managementName);
                console.log('Encoded:', encoded);
                console.log('Decoded:', decoded);
                console.log('Match:', managementName.toLowerCase().trim() === decoded.toLowerCase().trim());
            };

            // Main EntechReportSystem component
            const EntechReportSystem = () => {
                const [currentPage, setCurrentPage] = useState(0);
                const [reportData, setReportData] = useState(null);
                const [loading, setLoading] = useState(true);
                const [allManagements, setAllManagements] = useState([]);
                const [selectedManagement, setSelectedManagement] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');
                const [showingReport, setShowingReport] = useState(false);
                const [showingLinks, setShowingLinks] = useState(false);
                const [showingBulkTools, setShowingBulkTools] = useState(false);
                const [selectedManagements, setSelectedManagements] = useState(new Set());
                const [isExporting, setIsExporting] = useState(false);
                const [isClientMode, setIsClientMode] = useState(false);
                
                useEffect(() => {
                    loadManagements();
                    
                    // Also check URL on initial load and browser back/forward
                    const handleURLChange = () => {
                        if (allManagements.length > 0) {
                            const managementFromURL = getManagementFromURL();
                            if (managementFromURL) {
                                const management = allManagements.find(m => 
                                    m.name.toLowerCase().trim() === managementFromURL.toLowerCase().trim()
                                );
                                if (management) {
                                    generateReport(management);
                                }
                            }
                        }
                    };
                    
                    window.addEventListener('popstate', handleURLChange);
                    return () => window.removeEventListener('popstate', handleURLChange);
                }, []);
                
                useEffect(() => {
                    const managementFromURL = getManagementFromURL();
                    if (managementFromURL && allManagements.length > 0) {
                        const management = allManagements.find(m => 
                            m.name.toLowerCase().trim() === managementFromURL.toLowerCase().trim()
                        );
                        if (management) {
                            setIsClientMode(true); // Enable client mode for direct links
                            generateReport(management);
                        } else {
                            console.log('Management not found:', managementFromURL);
                            console.log('Available managements:', allManagements.map(m => m.name));
                        }
                    }
                }, [allManagements]);
                
                const loadManagements = () => {
                    try {
                        const grouped = groupBy(embeddedData, 'Management');
                        
                        const managementSummaries = Object.entries(grouped).map(([management, buildings]) => {
                            const totalSavings = buildings.reduce((sum, b) => sum + parseNumber(b.AmountSaved), 0);
                            const totalDowntime = buildings.reduce((sum, b) => sum + parseInt(b.TotalDiscByp || 0), 0);
                            const totalDowntimeCost = buildings.reduce((sum, b) => sum + parseNumber(b.TotalPotentialSaving), 0);
                            
                            return {
                                name: management,
                                buildingCount: buildings.length,
                                totalSavings: totalSavings,
                                totalDowntime: totalDowntime,
                                totalDowntimeCost: totalDowntimeCost,
                                buildings: buildings
                            };
                        }).sort((a, b) => a.name.localeCompare(b.name));
                        
                        setAllManagements(managementSummaries);
                        setLoading(false);
                    } catch (error) {
                        console.error('Error loading data:', error);
                        setLoading(false);
                    }
                };
                
                const generateReport = (management) => {
                    const buildings = management.buildings;
                    
                    const portfolioTotals = {
                        totalCurrentSavings: buildings.reduce((sum, b) => sum + parseNumber(b.AmountSaved), 0),
                        totalLifetimeSavings: buildings.reduce((sum, b) => sum + parseNumber(b.TotalSavedFromEntechAllTime), 0),
                        totalEntechAnnuals: buildings.reduce((sum, b) => sum + parseNumber(b.BasicFee), 0),
                        totalDowntime: buildings.reduce((sum, b) => sum + parseInt(b.TotalDiscByp || 0), 0),
                        totalDowntimeCost: buildings.reduce((sum, b) => sum + parseNumber(b.TotalPotentialSaving), 0),
                        totalProFee: buildings.reduce((sum, b) => sum + parseNumber(b.ProFee), 0),
                        totalBasicWithAssistant: buildings.reduce((sum, b) => sum + parseNumber(b.BasicWithAssistant), 0),
                        totalAdditionalSavingsIfPro: buildings.reduce((sum, b) => sum + parseNumber(b.AdditionalAmountSaveIfPro), 0),
                    };
                    
                    setReportData({
                        management: management.name,
                        buildings: buildings,
                        portfolioTotals
                    });
                    setSelectedManagement(management);
                    setShowingReport(true);
                    setShowingLinks(false);
                    setCurrentPage(0);
                    setManagementInURL(management.name);
                };
                
                const backToList = () => {
                    setShowingReport(false);
                    setSelectedManagement(null);
                    setReportData(null);
                    setShowingLinks(false);
                    setCurrentPage(0);
                    setManagementInURL(null);
                };
                
                // Generate current page dynamically
                const generateCurrentPage = useMemo(() => {
                    if (!reportData) return null;
                    
                    const staticPages = [
                        // Cover page
                        <div key="cover" className="h-screen bg-gray-800 flex items-center justify-center p-8">
                            <div className="bg-gray-700 rounded-3xl shadow-2xl p-12 max-w-5xl w-full flex">
                                <div className="w-1/2 pr-8 flex items-center justify-center">
                                    <div className="bg-gradient-to-br from-gray-600 to-gray-800 rounded-2xl w-full h-96 flex items-center justify-center">
                                        <Building className="text-gray-500 w-32 h-32" />
                                    </div>
                                </div>
                                <div className="w-1/2 flex flex-col justify-center">
                                    <div className="flex items-center mb-6">
                                        <div className="text-red-500 text-5xl mr-4">‚ö°</div>
                                        <div>
                                            <div className="text-3xl font-bold text-white">entech</div>
                                            <div className="text-red-500 text-xl">| {reportData.management}</div>
                                        </div>
                                    </div>
                                    <div className="text-gray-400 text-sm mb-4">{reportData.buildings.length} Buildings</div>
                                    <div className="overflow-y-auto max-h-64 space-y-1">
                                        {reportData.buildings.length > 10 ? (
                                            <>
                                                {reportData.buildings.slice(0, 5).map((building, idx) => (
                                                    <div key={idx} className="text-gray-300 text-sm">‚Ä¢ {building.Building}</div>
                                                ))}
                                                <div className="text-gray-400 text-sm italic py-1">... and {reportData.buildings.length - 5} more buildings</div>
                                            </>
                                        ) : (
                                            reportData.buildings.map((building, idx) => (
                                                <div key={idx} className="text-gray-300 text-sm">‚Ä¢ {building.Building}</div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>,
                        
                        // Problem page
                        <div key="page1" className="h-screen bg-gray-800 flex">
                            <div className="w-1/2 bg-gray-900 p-16 flex flex-col justify-center">
                                <h1 className="text-6xl font-bold text-white leading-tight mb-8">
                                    YOUR<br />
                                    ENTECH<br />
                                    INVESTMENT<br />
                                    ISN'T<br />
                                    DELIVERING<br />
                                    <span className="text-red-500">ITS FULL<br />POTENTIAL.</span>
                                </h1>
                            </div>
                            <div className="w-1/2 bg-gray-100 p-16 flex flex-col justify-center">
                                <p className="text-gray-700 text-xl mb-8">
                                    When you invested in Entech's energy management system, you expected consistent savings and improved building efficiency.
                                </p>
                                <p className="text-red-500 text-xl font-semibold">
                                    But here's what's actually happening: ‚Üí
                                </p>
                            </div>
                        </div>,
                        
                        // Bottom line page
                        <div key="page2" className="h-screen bg-gray-100 p-16">
                            <div className="max-w-6xl mx-auto">
                                <div className="grid grid-cols-2 gap-8 mb-16">
                                    <div className="bg-white rounded-2xl p-8 shadow-lg">
                                        <div className="text-red-500 text-4xl mb-4">üì°</div>
                                        <h3 className="text-red-500 text-2xl font-bold mb-4">System Downtime:</h3>
                                        <p className="text-gray-700 text-lg">
                                            Your Entech system frequently goes offline due to disconnections, server issues, or manual bypasses, meaning you're paying for savings you're not getting.
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-8 shadow-lg">
                                        <div className="text-red-500 text-4xl mb-4">üëÅÔ∏è</div>
                                        <h3 className="text-red-500 text-2xl font-bold mb-4">No Visibility:</h3>
                                        <p className="text-gray-700 text-lg">
                                            You don't know when these issues occur until it's too late, often discovering problems only when the energy bill arrives.
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-8 shadow-lg">
                                        <div className="text-red-500 text-4xl mb-4">‚Üª</div>
                                        <h3 className="text-red-500 text-2xl font-bold mb-4">Manual Overrides:</h3>
                                        <p className="text-gray-700 text-lg">
                                            When tenants complain about temperature, superintendents bypass Entech entirely and revert to manual controls, eliminating your energy savings for days or weeks at a time.
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-2xl p-8 shadow-lg">
                                        <div className="text-red-500 text-4xl mb-4">üí∏</div>
                                        <h3 className="text-red-500 text-2xl font-bold mb-4">Lost Savings:</h3>
                                        <p className="text-gray-700 text-lg">
                                            Every day your system is bypassed or disconnected, you're losing money. For many buildings, this adds up to thousands of dollars annually.
                                        </p>
                                    </div>
                                </div>
                                <div className="bg-gray-900 text-white p-8 rounded-2xl text-center">
                                    <h2 className="text-3xl font-bold">
                                        THE BOTTOM LINE:<br />
                                        <span className="text-red-500">YOU'RE LEAVING MONEY ON THE TABLE EVERY SINGLE DAY.</span>
                                    </h2>
                                </div>
                            </div>
                        </div>,
                        
                        // Introducing EntechAssistant
                        <div key="page3" className="h-screen bg-gray-100 flex items-center justify-center p-16">
                            <div className="max-w-5xl text-center">
                                <h1 className="text-6xl font-bold text-gray-800 mb-4">
                                    INTRODUCING:
                                </h1>
                                <h2 className="text-6xl font-bold text-red-500 mb-8">
                                    entechAssistant
                                </h2>
                                <p className="text-3xl text-gray-700 mb-16">
                                    Your 24/7 Energy Savings Guardian
                                </p>
                                <p className="text-xl text-gray-700 mb-16">
                                    EntechAssistant ensures your Entech system stays online and optimized, maximizing your investment through two critical services.
                                </p>
                                <div className="bg-gray-900 text-white p-6 rounded-2xl">
                                    <p className="text-xl">
                                        <span className="font-bold">RESULT:</span><br />
                                        <span className="text-red-500">YOUR ENTECH SYSTEM OPERATES AT PEAK EFFICIENCY 365 DAYS A YEAR, DELIVERING THE SAVINGS YOU INVESTED IN.</span>
                                    </p>
                                </div>
                            </div>
                        </div>,
                        
                        // Services page
                        <div key="page4" className="h-screen bg-gray-800 p-16">
                            <div className="max-w-6xl mx-auto h-full flex items-center">
                                <div className="grid grid-cols-2 gap-12 w-full">
                                    <div className="bg-white rounded-3xl p-12 shadow-2xl">
                                        <div className="text-red-500 text-5xl mb-6">üéØ</div>
                                        <h3 className="text-red-500 text-3xl font-bold mb-6">
                                            Intelligent Complaint Management
                                        </h3>
                                        <ul className="space-y-4 text-gray-700 text-lg">
                                            <li>‚Ä¢ Superintendents can text or call our automated assistant to log temperature complaints</li>
                                            <li>‚Ä¢ System automatically adjusts to address comfort issues while maintaining efficiency</li>
                                            <li>‚Ä¢ No more manual bypasses that waste thousands in energy costs</li>
                                        </ul>
                                    </div>
                                    <div className="bg-white rounded-3xl p-12 shadow-2xl">
                                        <div className="text-red-500 text-5xl mb-6">üë®‚Äçüíº</div>
                                        <h3 className="text-red-500 text-3xl font-bold mb-6">
                                            Proactive System Monitoring & Support
                                        </h3>
                                        <ul className="space-y-4 text-gray-700 text-lg">
                                            <li>‚Ä¢ Real-time monitoring detects disconnections and bypasses instantly</li>
                                            <li>‚Ä¢ Immediate outreach via call, text, and email to your building staff</li>
                                            <li>‚Ä¢ Step-by-step guidance to restore connection</li>
                                            <li>‚Ä¢ We don't stop until your system is back online and saving you thousands in energy costs</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ];
                    
                    // Building pages
                    const buildingStartIndex = 5;
                    const buildingEndIndex = buildingStartIndex + reportData.buildings.length;
                    
                    if (currentPage >= buildingStartIndex && currentPage < buildingEndIndex) {
                        const buildingIndex = currentPage - buildingStartIndex;
                        const building = reportData.buildings[buildingIndex];
                        
                        return (
                            <div key={`building-${buildingIndex}`} className="h-screen bg-white p-12 overflow-auto">
                                <div className="max-w-6xl mx-auto">
                                    {/* Header */}
                                    <div className="text-center mb-8">
                                        <h1 className="text-4xl font-bold text-gray-900 mb-2">{building.Building}</h1>
                                        <p className="text-xl text-gray-600">Your Energy Performance Report</p>
                                    </div>
                                    
                                    {/* THE PROBLEM - Money You're Losing */}
                                    <div className="loss-highlight rounded-xl p-8 mb-8">
                                        <h2 className="text-2xl font-bold text-red-600 mb-6 flex items-center">
                                            <span className="text-3xl mr-3">‚ö†Ô∏è</span>
                                            Money You're Losing Every Year
                                        </h2>
                                        <div className="grid grid-cols-2 gap-8">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">SYSTEM DOWNTIME</div>
                                                <div className="text-4xl font-bold text-red-600">{building.TotalDiscByp} days</div>
                                                <div className="text-gray-700 mt-2">Your system was offline</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">COST OF DOWNTIME</div>
                                                <div className="text-4xl font-bold text-red-600">{parseCurrency(building.TotalPotentialSaving)}</div>
                                                <div className="text-gray-700 mt-2">Lost savings per year</div>
                                            </div>
                                        </div>
                                        <div className="mt-6 p-4 bg-red-50 rounded-lg border border-red-200">
                                            <p className="text-red-700 font-semibold text-center">
                                                Every day your system is down, you're throwing money away
                                            </p>
                                        </div>
                                    </div>
                                    
                                    {/* Current Performance */}
                                    <div className="bg-gray-50 rounded-xl p-8 mb-8">
                                        <h2 className="text-2xl font-bold text-gray-900 mb-6">Current Performance</h2>
                                        <div className="grid grid-cols-3 gap-6">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">ANNUAL ENTECH FEE</div>
                                                <div className="text-3xl font-bold text-gray-900">{parseCurrency(building.BasicFee)}</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">CURRENT SAVINGS</div>
                                                <div className="text-3xl font-bold text-green-600">{parseCurrency(building.AmountSaved)}</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">LIFETIME SAVINGS</div>
                                                <div className="text-3xl font-bold text-gray-900">{parseCurrency(building.TotalSavedFromEntechAllTime)}</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* THE SOLUTION - What You Could Be Saving */}
                                    <div className="savings-highlight rounded-xl p-8">
                                        <h2 className="text-2xl font-bold text-green-600 mb-6 flex items-center">
                                            <span className="text-3xl mr-3">üí∞</span>
                                            With EntechAssistant Upgrade
                                        </h2>
                                        <div className="grid grid-cols-3 gap-6">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">NEW ANNUAL FEE</div>
                                                <div className="text-2xl font-bold text-gray-900">{parseCurrency(building.BasicWithAssistant)}</div>
                                                <div className="text-sm text-gray-600 mt-1">
                                                    Only +{formatCurrency(parseNumber(building.BasicWithAssistant) - parseNumber(building.BasicFee))} more
                                                </div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">ADDITIONAL SAVINGS</div>
                                                <div className="text-2xl font-bold text-green-600">{parseCurrency(building.TotalPotentialSaving)}</div>
                                                <div className="text-sm text-green-600 mt-1">Money recovered</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">TOTAL ANNUAL SAVINGS</div>
                                                <div className="text-3xl font-bold text-green-600">
                                                    {formatCurrency(parseNumber(building.AmountSaved) + parseNumber(building.TotalPotentialSaving))}
                                                </div>
                                                <div className="text-sm text-green-600 mt-1">Your new total</div>
                                            </div>
                                        </div>
                                        <div className="mt-8 p-6 bg-green-50 rounded-lg border border-green-200">
                                            <div className="text-center">
                                                <div className="text-green-800 font-bold text-xl mb-2">ROI: Immediate</div>
                                                <div className="text-green-700">
                                                    The upgrade pays for itself by stopping your losses
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    }
                    
                    // Management Summary
                    const summaryPageIndex = buildingEndIndex;
                    if (reportData.buildings.length > 1 && currentPage === summaryPageIndex) {
                        return (
                            <div key="summary" className="h-screen bg-white p-12 overflow-auto">
                                <div className="max-w-7xl mx-auto">
                                    {/* Header */}
                                    <div className="text-center mb-8">
                                        <h1 className="text-4xl font-bold text-gray-900 mb-2">{reportData.management}</h1>
                                        <p className="text-xl text-gray-600">Portfolio Performance Summary</p>
                                        <p className="text-lg text-gray-500 mt-2">{reportData.buildings.length} Buildings</p>
                                    </div>
                                    
                                    {/* THE BIG PICTURE - Money You're Losing */}
                                    <div className="loss-highlight rounded-xl p-8 mb-8">
                                        <h2 className="text-3xl font-bold text-red-600 mb-8 text-center flex items-center justify-center">
                                            <span className="text-4xl mr-4">üí∏</span>
                                            You're Losing Money Across Your Entire Portfolio
                                        </h2>
                                        <div className="grid grid-cols-2 gap-12">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">TOTAL SYSTEM DOWNTIME</div>
                                                <div className="text-5xl font-bold text-red-600 mb-2">{reportData.portfolioTotals.totalDowntime}</div>
                                                <div className="text-xl text-red-600 font-semibold">DAYS OFFLINE</div>
                                                <div className="text-gray-700 mt-2">Across all your buildings</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">ANNUAL LOSSES</div>
                                                <div className="text-5xl font-bold text-red-600 mb-2">{formatCurrency(reportData.portfolioTotals.totalDowntimeCost)}</div>
                                                <div className="text-xl text-red-600 font-semibold">LOST EVERY YEAR</div>
                                                <div className="text-gray-700 mt-2">Money you could be saving</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Current Performance */}
                                    <div className="bg-gray-50 rounded-xl p-8 mb-8">
                                        <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Current Portfolio Performance</h2>
                                        <div className="grid grid-cols-3 gap-8">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">ANNUAL ENTECH FEES</div>
                                                <div className="text-3xl font-bold text-gray-900">{formatCurrency(reportData.portfolioTotals.totalEntechAnnuals)}</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">CURRENT SAVINGS</div>
                                                <div className="text-3xl font-bold text-green-600">{formatCurrency(reportData.portfolioTotals.totalCurrentSavings)}</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">LIFETIME SAVINGS</div>
                                                <div className="text-3xl font-bold text-gray-900">{formatCurrency(reportData.portfolioTotals.totalLifetimeSavings)}</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* THE SOLUTION - Portfolio Upgrade Impact */}
                                    <div className="savings-highlight rounded-xl p-8">
                                        <h2 className="text-3xl font-bold text-green-600 mb-8 text-center flex items-center justify-center">
                                            <span className="text-4xl mr-4">üöÄ</span>
                                            Portfolio-Wide EntechAssistant Upgrade
                                        </h2>
                                        <div className="grid grid-cols-3 gap-8">
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">NEW ANNUAL INVESTMENT</div>
                                                <div className="text-2xl font-bold text-gray-900">{formatCurrency(reportData.portfolioTotals.totalBasicWithAssistant)}</div>
                                                <div className="text-sm text-gray-600 mt-1">
                                                    Additional: {formatCurrency(reportData.portfolioTotals.totalBasicWithAssistant - reportData.portfolioTotals.totalEntechAnnuals)}
                                                </div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">RECOVERED LOSSES</div>
                                                <div className="text-3xl font-bold text-green-600">{formatCurrency(reportData.portfolioTotals.totalDowntimeCost)}</div>
                                                <div className="text-sm text-green-600 mt-1">Money saved annually</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-sm text-gray-600 mb-2">NEW TOTAL SAVINGS</div>
                                                <div className="text-4xl font-bold text-green-600">
                                                    {formatCurrency(reportData.portfolioTotals.totalCurrentSavings + reportData.portfolioTotals.totalDowntimeCost)}
                                                </div>
                                                <div className="text-sm text-green-600 mt-1">Your optimized portfolio</div>
                                            </div>
                                        </div>
                                        <div className="mt-8 p-6 bg-green-50 rounded-lg border border-green-200">
                                            <div className="text-center">
                                                <div className="text-green-800 font-bold text-2xl mb-2">
                                                    Net Benefit: {formatCurrency(reportData.portfolioTotals.totalDowntimeCost - (reportData.portfolioTotals.totalBasicWithAssistant - reportData.portfolioTotals.totalEntechAnnuals))} / year
                                                </div>
                                                <div className="text-green-700 text-lg">
                                                    The upgrade pays for itself immediately by stopping your losses
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    }
                    
                    // End pages
                    const endPages = [
                        // Entech Pro
                        <div key="pro" className="h-screen bg-gray-800 flex">
                            <div className="w-1/3 bg-gray-900 p-16 flex flex-col justify-center">
                                <div className="bg-gray-800 rounded-2xl p-4 mb-8 inline-block w-fit">
                                    <div className="text-white text-2xl">entech</div>
                                    <div className="text-red-500 text-3xl font-bold">PRO</div>
                                </div>
                                <h2 className="text-5xl font-bold text-white mb-8">
                                    YOUR<br />
                                    BUILDINGS,<br />
                                    <span className="text-red-500">EXPERTLY<br />
                                    MANAGED<br />
                                    24/7.</span>
                                </h2>
                                <p className="text-gray-400 text-lg">
                                    Entech Pro assigns a dedicated team to actively manage your entire portfolio.
                                </p>
                            </div>
                            <div className="w-2/3 bg-gray-100 p-16">
                                <div className="grid grid-cols-2 gap-8">
                                    <div className="space-y-8">
                                        <div className="bg-white rounded-2xl p-8 shadow-lg">
                                            <h3 className="text-red-500 text-xl font-bold mb-3">Round-the-clock monitoring</h3>
                                            <p className="text-gray-700">We watch every building, every hour.</p>
                                        </div>
                                        <div className="bg-white rounded-2xl p-8 shadow-lg">
                                            <h3 className="text-red-500 text-xl font-bold mb-3">Direct communication</h3>
                                            <p className="text-gray-700">We work directly with your supers and staff</p>
                                        </div>
                                    </div>
                                    <div className="space-y-8">
                                        <div className="bg-white rounded-2xl p-8 shadow-lg">
                                            <h3 className="text-red-500 text-xl font-bold mb-3">Proactive intervention</h3>
                                            <p className="text-gray-700">Fix problems before tenants notice</p>
                                        </div>
                                        <div className="bg-white rounded-2xl p-8 shadow-lg">
                                            <h3 className="text-red-500 text-xl font-bold mb-3">Continuous optimization</h3>
                                            <p className="text-gray-700">Real-time adjustments for maximum efficiency</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="mt-16 text-center">
                                    <p className="text-lg text-gray-700">
                                        The results: <span className="text-red-500 font-bold">Pro clients save an additional 10% on average‚Äîthat's often $20,000+ extra savings in year one.</span>
                                    </p>
                                </div>
                            </div>
                        </div>,
                        
                        // Investment
                        <div key="investment" className="h-screen bg-gray-800 flex items-center justify-center p-16">
                            <div className="max-w-4xl w-full">
                                <h2 className="text-red-500 text-5xl font-bold mb-12 text-center">YOUR INVESTMENT</h2>
                                <div className="bg-gray-700 rounded-3xl p-12 shadow-2xl space-y-6">
                                    <div className="flex justify-between items-center pb-6 border-b border-gray-600">
                                        <span className="text-gray-300 text-2xl">Pro Portfolio Fee</span>
                                        <span className="text-white text-3xl font-bold">{formatCurrency(reportData.portfolioTotals.totalProFee)}</span>
                                    </div>
                                    <div className="flex justify-between items-center pb-6 border-b border-gray-600">
                                        <span className="text-gray-300 text-2xl">Additional Cost</span>
                                        <span className="text-white text-3xl font-bold">
                                            {formatCurrency(reportData.portfolioTotals.totalProFee - reportData.portfolioTotals.totalBasicWithAssistant)}
                                        </span>
                                    </div>
                                    <div className="flex justify-between items-center pt-6">
                                        <span className="text-gray-300 text-2xl">Estimated Additional Savings</span>
                                        <span className="text-green-400 text-4xl font-bold">
                                            {formatCurrency(reportData.portfolioTotals.totalAdditionalSavingsIfPro)}
                                        </span>
                                    </div>
                                </div>
                                <p className="text-center text-xl text-gray-400 mt-12">
                                    The bottom line: <span className="text-red-500 font-bold">Expert eyes on your buildings 24/7, delivering savings while you sleep.</span>
                                </p>
                            </div>
                        </div>,
                        
                    ];
                    
                    const endPageStartIndex = reportData.buildings.length > 1 ? summaryPageIndex + 1 : buildingEndIndex;
                    const endPageIndex = currentPage - endPageStartIndex;
                    
                    if (endPageIndex >= 0 && endPageIndex < endPages.length) {
                        return endPages[endPageIndex];
                    }
                    
                    if (currentPage < staticPages.length) {
                        return staticPages[currentPage];
                    }
                    
                    return null;
                }, [currentPage, reportData]);
                
                const totalPages = useMemo(() => {
                    if (!reportData) return 0;
                    const staticStartPages = 5;
                    const buildingPages = reportData.buildings.length;
                    const summaryPage = reportData.buildings.length > 1 ? 1 : 0;
                    const endPages = 2;
                    return staticStartPages + buildingPages + summaryPage + endPages;
                }, [reportData]);
                
                if (loading) {
                    return <div className="flex items-center justify-center h-screen bg-gray-900 text-white">Loading management data...</div>;
                }
                
                // Management Selection Screen
                if (!showingReport) {
                    const filteredManagements = allManagements.filter(m => 
                        m.name.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    
                    return (
                        <div className="min-h-screen bg-gray-900 p-8">
                            <div className="max-w-7xl mx-auto">
                                <div className="text-center mb-12 fade-in">
                                    <div className="flex items-center justify-center mb-4">
                                        <div className="text-red-500 text-6xl mr-4">‚ö°</div>
                                        <h1 className="text-5xl font-bold gradient-text">entechAssistant</h1>
                                    </div>
                                    <p className="text-2xl text-gray-400 mb-6">Advanced Report Generation & Client Distribution System</p>
                                    <div className="flex flex-wrap justify-center gap-4">
                                        <button
                                            onClick={() => setShowingLinks(!showingLinks)}
                                            className="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition card-hover flex items-center gap-2"
                                        >
                                            <External className="w-5 h-5" />
                                            {showingLinks ? 'Hide Links' : 'Show Individual Links'}
                                        </button>
                                        <button
                                            onClick={() => setShowingBulkTools(!showingBulkTools)}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition card-hover flex items-center gap-2"
                                        >
                                            <Download className="w-5 h-5" />
                                            {showingBulkTools ? 'Hide' : 'Show'} Bulk Tools
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="relative mb-8">
                                    <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                                    <input
                                        type="text"
                                        placeholder="Search management companies..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-12 pr-4 py-4 bg-gray-800 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                                    />
                                </div>
                                
                                <div className="grid grid-cols-3 gap-6 mb-8">
                                    <div className="metric-card rounded-lg p-6 text-center">
                                        <Users className="w-8 h-8 text-red-400 mx-auto mb-3" />
                                        <div className="text-3xl font-bold text-white mb-1">{allManagements.length}</div>
                                        <div className="text-gray-400">Companies</div>
                                    </div>
                                    <div className="metric-card rounded-lg p-6 text-center">
                                        <Building className="w-8 h-8 text-blue-400 mx-auto mb-3" />
                                        <div className="text-3xl font-bold text-white mb-1">
                                            {allManagements.reduce((sum, m) => sum + m.buildingCount, 0)}
                                        </div>
                                        <div className="text-gray-400">Buildings</div>
                                    </div>
                                    <div className="metric-card rounded-lg p-6 text-center">
                                        <DollarSign className="w-8 h-8 text-green-400 mx-auto mb-3" />
                                        <div className="text-3xl font-bold text-green-400 mb-1">
                                            {formatCurrency(allManagements.reduce((sum, m) => sum + m.totalSavings, 0))}
                                        </div>
                                        <div className="text-gray-400">Total Savings</div>
                                    </div>
                                </div>
                                
                                {showingLinks && (
                                    <div className="glass-effect rounded-xl p-6 mb-8 slide-up">
                                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <External className="w-6 h-6 text-red-400" />
                                            Individual Management Links
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                                            {filteredManagements.map((management, idx) => (
                                                <div key={idx} className="bg-gray-700 rounded-lg p-4 card-hover">
                                                    <div className="text-white font-semibold mb-2 truncate" title={management.name}>
                                                        {management.name}
                                                    </div>
                                                    <div className="text-sm text-gray-400 mb-3">
                                                        {management.buildingCount} buildings
                                                    </div>
                                                    <input
                                                        type="text"
                                                        value={generateManagementLink(management.name)}
                                                        readOnly
                                                        className="w-full bg-gray-600 text-white text-xs p-2 rounded mb-2 focus:ring-2 focus:ring-red-500"
                                                        onClick={(e) => e.target.select()}
                                                    />
                                                    <button
                                                        onClick={() => {
                                                            navigator.clipboard.writeText(generateManagementLink(management.name));
                                                            showToast(`Link copied for ${management.name}`, 'success');
                                                        }}
                                                        className="w-full bg-red-500 text-white py-2 px-2 rounded text-xs hover:bg-red-600 transition flex items-center justify-center gap-1"
                                                    >
                                                        <Copy className="w-3 h-3" />
                                                        Copy Link
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {showingBulkTools && (
                                    <div className="glass-effect rounded-xl p-6 mb-8 slide-up">
                                        <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <Download className="w-6 h-6 text-blue-400" />
                                            Bulk Client Management Tools
                                        </h3>
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <button
                                                onClick={() => {
                                                    setSelectedManagements(new Set(allManagements.map(m => m.name)));
                                                    showToast('All companies selected', 'success');
                                                }}
                                                className="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition flex items-center gap-2 justify-center card-hover"
                                            >
                                                <Check className="w-4 h-4" />
                                                Select All
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setSelectedManagements(new Set());
                                                    showToast('Selection cleared', 'success');
                                                }}
                                                className="bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-2 justify-center card-hover"
                                            >
                                                <Copy className="w-4 h-4" />
                                                Clear All
                                            </button>
                                        </div>
                                        <div className="text-sm text-gray-400">
                                            Select companies using the checkboxes, then use these tools to export data or generate email templates for client distribution.
                                        </div>
                                    </div>
                                )}
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {filteredManagements.map((management, idx) => (
                                        <div
                                            key={idx}
                                            className="glass-effect rounded-xl p-6 card-hover slide-up relative"
                                            style={{ animationDelay: `${idx * 100}ms` }}
                                        >
                                            <div className="absolute top-4 right-4">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedManagements.has(management.name)}
                                                    onChange={(e) => {
                                                        const newSelected = new Set(selectedManagements);
                                                        if (e.target.checked) {
                                                            newSelected.add(management.name);
                                                        } else {
                                                            newSelected.delete(management.name);
                                                        }
                                                        setSelectedManagements(newSelected);
                                                        e.stopPropagation();
                                                    }}
                                                    className="w-4 h-4 text-red-600 bg-gray-100 rounded focus:ring-red-500"
                                                />
                                            </div>
                                            
                                            <div className="cursor-pointer" onClick={() => generateReport(management)}>
                                                <div className="flex items-center mb-4">
                                                    <Building className="w-6 h-6 text-red-400 mr-2" />
                                                    <h3 className="text-xl font-bold text-white truncate">{management.name}</h3>
                                                </div>
                                                
                                                <div className="space-y-3 text-sm mb-4">
                                                    <div className="flex justify-between items-center p-2 bg-gray-800 bg-opacity-50 rounded-lg">
                                                        <span className="text-gray-300 font-medium">Buildings:</span>
                                                        <span className="data-badge px-3 py-1 rounded-full text-xs font-bold text-white">
                                                            {management.buildingCount}
                                                        </span>
                                                    </div>
                                                    <div className="flex justify-between items-center p-2 bg-gray-800 bg-opacity-50 rounded-lg">
                                                        <span className="text-gray-300 font-medium">Current Savings:</span>
                                                        <span className="text-green-400 font-bold text-lg">{formatCurrency(management.totalSavings)}</span>
                                                    </div>
                                                    <div className="flex justify-between items-center p-2 bg-gray-800 bg-opacity-50 rounded-lg">
                                                        <span className="text-gray-300 font-medium">Downtime:</span>
                                                        <span className="text-orange-400 font-semibold">{management.totalDowntime} days</span>
                                                    </div>
                                                    <div className="flex justify-between items-center p-2 bg-gray-800 bg-opacity-50 rounded-lg">
                                                        <span className="text-gray-300 font-medium">Lost Savings:</span>
                                                        <span className="text-red-400 font-bold">{formatCurrency(management.totalDowntimeCost)}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-2">
                                                <button 
                                                    onClick={() => generateReport(management)}
                                                    className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition flex items-center justify-center gap-2 font-semibold"
                                                >
                                                    <External className="w-4 h-4" />
                                                    Generate Report
                                                </button>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            navigator.clipboard.writeText(generateManagementLink(management.name));
                                                            showToast(`Link copied for ${management.name}`, 'success');
                                                        }}
                                                        className="flex-1 bg-gray-600 text-white py-2 px-3 rounded-lg hover:bg-gray-500 transition flex items-center justify-center gap-2 text-sm"
                                                    >
                                                        <Copy className="w-3 h-3" />
                                                        Copy Link
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            window.open(generateManagementLink(management.name), '_blank');
                                                        }}
                                                        className="flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-500 transition flex items-center justify-center gap-2 text-sm"
                                                    >
                                                        <External className="w-3 h-3" />
                                                        Open
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                {filteredManagements.length === 0 && (
                                    <div className="text-center text-gray-400 py-12">
                                        No management companies found matching "{searchTerm}"
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }
                
                // Report View
                return (
                    <div className="bg-gray-900 min-h-screen">
                        <div className="fixed top-0 left-0 right-0 glass-effect z-50 p-4 no-print">
                            <div className="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
                                <div className="flex items-center space-x-4">
                                    {!isClientMode && (
                                        <button
                                            onClick={backToList}
                                            className="text-white hover:text-red-500 transition flex items-center card-hover px-3 py-2 rounded-lg"
                                        >
                                            <ChevronLeft className="w-5 h-5 mr-1" />
                                            Back to List
                                        </button>
                                    )}
                                    <span className="text-white font-semibold">
                                        {reportData.management} | Page {currentPage + 1} of {totalPages}
                                    </span>
                                </div>
                                
                                <div className="flex items-center space-x-2">
                                    <button
                                        onClick={() => exportToPDF(reportData.management, reportData, currentPage, totalPages)}
                                        disabled={isExporting}
                                        className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center gap-2 text-sm card-hover disabled:opacity-50"
                                    >
                                        <Download className="w-4 h-4" />
                                        Export Page
                                    </button>
                                    <button
                                        onClick={() => {
                                            setIsExporting(true);
                                            exportFullReportToPDF(reportData.management, reportData, setCurrentPage, totalPages)
                                                .finally(() => setIsExporting(false));
                                        }}
                                        disabled={isExporting}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2 text-sm card-hover disabled:opacity-50"
                                    >
                                        <Download className="w-4 h-4" />
                                        {isExporting ? 'Exporting...' : 'Export Full PDF'}
                                    </button>
                                    <button
                                        onClick={() => {
                                            navigator.clipboard.writeText(window.location.href);
                                            showToast('Report link copied!', 'success');
                                        }}
                                        className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition flex items-center gap-2 text-sm card-hover"
                                    >
                                        <Copy className="w-4 h-4" />
                                        Share
                                    </button>
                                </div>
                                
                                {reportData.buildings.length > 5 && (
                                    <select 
                                        onChange={(e) => setCurrentPage(parseInt(e.target.value))}
                                        value={currentPage}
                                        className="bg-gray-800 text-white px-3 py-1 rounded border border-gray-700 mr-4 text-sm max-w-xs"
                                    >
                                        <option value={0}>Cover</option>
                                        <option value={1}>Problem Overview</option>
                                        <option value={2}>Solution Overview</option>
                                        <option value={3}>EntechAssistant</option>
                                        <option value={4}>Services</option>
                                        <optgroup label="Buildings">
                                            {reportData.buildings.map((building, idx) => (
                                                <option key={idx} value={5 + idx}>
                                                    {building.Building} ({building.TotalDiscByp || 0} days offline)
                                                </option>
                                            ))}
                                        </optgroup>
                                        {reportData.buildings.length > 1 && (
                                            <option value={5 + reportData.buildings.length}>Portfolio Summary</option>
                                        )}
                                        <option value={reportData.buildings.length > 1 ? 6 + reportData.buildings.length : 5 + reportData.buildings.length}>Entech Pro</option>
                                        <option value={reportData.buildings.length > 1 ? 7 + reportData.buildings.length : 6 + reportData.buildings.length}>Investment</option>
                                        <option value={reportData.buildings.length > 1 ? 8 + reportData.buildings.length : 7 + reportData.buildings.length}>Event</option>
                                    </select>
                                )}
                                
                                <div className="flex space-x-4">
                                    <button
                                        onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}
                                        disabled={currentPage === 0}
                                        className="text-white hover:text-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition"
                                    >
                                        <ChevronLeft className="w-6 h-6" />
                                    </button>
                                    <button
                                        onClick={() => setCurrentPage(Math.min(totalPages - 1, currentPage + 1))}
                                        disabled={currentPage === totalPages - 1}
                                        className="text-white hover:text-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition"
                                    >
                                        <ChevronRight className="w-6 h-6" />
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div className="pt-16">
                            {generateCurrentPage}
                        </div>
                        
                        {totalPages <= 15 && (
                            <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-2">
                                {Array.from({ length: totalPages }, (_, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => setCurrentPage(idx)}
                                        className={`w-2 h-2 rounded-full transition ${
                                            idx === currentPage ? 'bg-red-500 w-8' : 'bg-gray-600 hover:bg-gray-500'
                                        }`}
                                    />
                                ))}
                            </div>
                        )}
                    </div>
                );
            };
            
            // Render the app
            ReactDOM.render(<EntechReportSystem />, document.getElementById('root'));
        }
    </script>
</body>
</html>